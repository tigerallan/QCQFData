<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>综合统计</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
		<link href="css/reset.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/index.css" />
		<style>
			.mui-dtpicker-title{display: none;}
			.mui-picker{background: #fff;}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-card">
				<ul class="mui-table-view people">
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">
							<div class="mui-row">
								<div class="mui-col-sm-3 mui-col-xs-3">
									<img class="titleImg" src="img/2_3.png" />
								</div>
								<div class="mui-col-sm-9 mui-col-xs-9 context">
									群测群防人员上报率
									<p class="mui-ellipsis text_js">按月统计群测群防上报率</p>
								</div>
							</div>
						</a>
						<div class="mui-collapse-content mui-row">
							<div class="mui-col-sm-12 mui-col-xs-12 bg_qcry" >
								<div class="mui-col-sm-4 mui-col-xs-4 bg_select">
									<select id="area_xz" class="pqry" onchange="areaxz(this,'monitor')">
										<option value="">选择乡镇</option>
									</select>
								</div>
								<div class="mui-col-sm-4 mui-col-xs-4" style="float: left; border-right: 1px solid #ccc;">
									<button data-options='{"type":"date","beginDay":"new Date()"}' class="btn mui-btn setbut mui-btn-block">选择开始日期 </button>
									<!--<input class="date"  type="date" placeholder="选择开始时间"/>-->
								</div>
								<div class="mui-col-sm-4  mui-left mui-col-xs-4" style="float: left;">
									<button data-options='{"type":"date"}' class="btn mui-btn setbut mui-btn-block">选择结束日期 </button>
									
									<!--<input onchange="datemiss(this,1)" class="date" style="width: 100%; margin: 0px; padding: 0px; font-size: 12px; text-align: center; border:0px; position: absolute;left: 0;right: 0;top: 0; bottom: 0;" type="date" placeholder="选择结束时间"/>-->
								</div>
							</div>
								<div style="width: 100%;display:flex;" class="quxian mui-col-sm-9  mui-left mui-col-xs-12">
									<div style="width:32%">乡镇</div>
									<div style="width:20%">应上报</div>
									<div style="width:20%">实上报</div>
									<div style="width:28%">上报率</div>
								</div>
							<table id="monitor" class="table_head">
								<tr class="quxian">
									<th width="32%"></th>
									<th width="20%"></th>
									<th width="20%"></th>
									<th width="28%"></th>
								</tr>
							</table>
						</div>
					</li>
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">
							<div class="mui-row">
								<div class="mui-col-sm-3 mui-col-xs-3">
									<img class="titleImg" src="img/2_4.png" />
								</div>
								<div class="mui-col-sm-9 mui-col-xs-9 context">
									片区专管人员上报率
									<p class="mui-ellipsis text_js">按月统计片区专管人员周报上报率</p>
								</div>
							</div>
						</a>
						<div class="mui-collapse-content mui-row">
							<div class="mui-col-sm-12 mui-col-xs-12 bg_qcry">
							<div class="mui-col-sm-4 mui-left mui-col-xs-4 bg_select">
									<select id="area_pq" class="pqry" onchange="areaxz(this,'weekly')">
										<option value="">选择乡镇</option>
									</select>
								</div>
								
								<div class="mui-col-sm-4 mui-col-xs-4" style="float: left;border-right: 1px solid #ccc;">
									<button data-options='{"type":"date","beginDay":"new Date()"}' style="" class="btn mui-btn setbut mui-btn-block">选择开始日期 </button>
									<!--<input class="date"  type="date" placeholder="选择开始时间"/>-->
								</div>
								<div class="mui-col-sm-4  mui-left mui-col-xs-4" style="float: left; position: relative;">
									<button data-options='{"type":"date"}' class="btn mui-btn setbut mui-btn-block">选择结束日期 </button>
									
									<!--<input onchange="datemiss(this,1)" class="date" style="width: 100%; margin: 0px; padding: 0px; font-size: 12px; text-align: center; border:0px; position: absolute;left: 0;right: 0;top: 0; bottom: 0;" type="date" placeholder="选择结束时间"/>-->
								</div>
							</div>
								<div style="width: 100%;display:flex;" class="quxian mui-col-sm-9  mui-left mui-col-xs-12">
									<div style="width:32%">乡镇</div>
									<div style="width:20%">上报人</div>
									<div style="width:15%">应上报</div>
									<div style="width:15%">实上报</div>
									<div style="width:20%">上报率</div>
								</div>
							<table id="weekly" class="table_head">
							</table>
						</div>
					</li>
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">
							<div class="mui-row">
								<div class="mui-col-sm-3 mui-col-xs-3">
									<img class="titleImg" src="img/2_5.png" />
								</div>
								<div class="mui-col-sm-9 mui-col-xs-9 context">
									驻守人员上报率
									<p class="mui-ellipsis text_js">按月统计驻守人员上报率</p>
								</div>
							</div>
						</a>
						<div class="mui-collapse-content mui-row">
							<div class="mui-col-sm-12 mui-col-xs-12 bg_qcry">
								<div class="mui-col-sm-4 mui-left mui-col-xs-4 bg_select">
									<select id="area_zs" class="pqry" onchange="areaxz(this,'journal')">
										<option value="">选择乡镇</option>
									</select>
								</div>
							
								<div class="mui-col-sm-4 mui-col-xs-4" style="float: left;border-right: 1px solid #ccc;">
									<button data-options='{"type":"date","beginDay":"new Date()"}' style="" class="btn mui-btn setbut mui-btn-block">选择开始日期 </button>
									<!--<input class="date"  type="date" placeholder="选择开始时间"/>-->
								</div>
								<div class="mui-col-sm-4  mui-left mui-col-xs-4" style="float: left; position: relative;">
									<button data-options='{"type":"date"}' class="btn mui-btn setbut mui-btn-block">选择结束日期 </button>
							
									<!--<input onchange="datemiss(this,1)" class="date" style="width: 100%; margin: 0px; padding: 0px; font-size: 12px; text-align: center; border:0px; position: absolute;left: 0;right: 0;top: 0; bottom: 0;" type="date" placeholder="选择结束时间"/>-->
								</div>
							</div>
							<div style="width: 100%;display:flex;" class="quxian mui-col-sm-9  mui-left mui-col-xs-12">
								<div style="width:32%">乡镇</div>
								<div style="width:20%">上报人</div>
								<div style="width:15%">应上报</div>
								<div style="width:15%">实上报</div>
								<div style="width:20%">上报率</div>
							</div>
							<table id="journal" class="table_head">
								<!--<tr class="quxian">
									<th width="25%">上报人</th>
									<th width="25%">应上报</th>
									<th width="25%">实上报</th>
									<th width="25%">上报率</th>
								</tr>-->
							</table>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/mui.picker.min.js"></script>
	<script type="text/javascript" src="js/ipconfig.js"></script>
	<script src="js/jquery-1.11.3.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
	<script>
			
			(function($) {
				$.init();
				var btns = $('.btn');
				var result = $('#demo4')[0];
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var _self = this;
							var optionsJson = this.getAttribute('data-options') || '{}';
							var options = JSON.parse(optionsJson);
							var dtpicker = new mui.DtPicker({
			                    type: "date",//设置日历初始视图模式    //真正的月份比写的多一个月。  type的类型你还是可以选择date, datetime month time  hour 
			                    beginDate: new Date(2000, 04, 02),  
			                    endDate: new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()),//设置结束日期    //真正的是10.21
			                    labels: ['年', '月', '日'],
			                
			                })
							var id = this.getAttribute('id');
							_self.picker = new $.DtPicker(options);
							dtpicker.show(function(rs) {
								btn.innerText=rs.text;
								_self.picker.dispose();
								_self.picker = null;
								
								setTimeout(function(){
									datemiss(i,rs.text);
								},200)
							});
						
					}, false);
				});
			})(mui);
			$(".date").on("input",function(){
			   if($(this).val().length>0){
			   $(this).addClass("full");
			}
			else{
			  $(this).removeClass("full");
			  }
			 });
			 var startTime="",endTime="",startTime1="",endTime1="",startTime2="",endTime2="";
			function datemiss(ts,num){
				if(ts=='0'||ts=="1"){
					if(ts==0){
						startTime=num;
						if(endTime!=""){
							if(endTime<startTime){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(0)
							}
						}
					}else{
						endTime=num;
						if(startTime!=""){
							if(endTime<startTime){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(0)
							}
						}
					}
				}else if(ts=='2'||ts=="3"){
					if(ts==2){
						startTime1=num;
						if(endTime1!=""){
							if(endTime1<startTime1){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(1)
							}
						}
					}else{
						endTime1=num;
						if(startTime1!=""){
							if(endTime1<startTime1){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(1)
							}
						}
					}
				}else if(ts=='4'||ts=="5"){
					if(ts==4){
						startTime2=num;
						if(endTime2!=""){
							if(endTime2<startTime2){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(2)
							}
						}
					}else{
						endTime2=num;
						if(startTime2!=""){
							if(endTime2<startTime2){
								mui.alert("结束时间不能小于开始时间");
								return false;
							}else{
								loadtime(2)
							}
						}
					}
				}
				/*var d=new Date($(ts).val())
				var weekday=new Array(7);
				weekday[0]="7";
				weekday[1]="1";
				weekday[2]="2";
				weekday[3]="3";
				weekday[4]="4";
				weekday[5]="5";
				weekday[6]="6";
				//alert(weekday[d.getDay()])返回当前时间是星期几
				var s=weekday[d.getDay()]-1;
				var y=s*24*60*60*1000;*/
				
				/*if(num==0){
					var i=Date.parse(new Date($(ts).val()))-y;
					//开始时间
					startTime=timestampToTime(new Date($(ts).val()));
				}
				else{
					var i=Date.parse(new Date($(ts).val()))+y;
					//结束时间
					endTime=timestampToTime(new Date($(ts).val()));
					if(endTime<startTime){
						mui.alert("结束时间不能小于开始时间");
						$(ts).val("");
						endTime=0;
						return false;
					}else{
						loadtime()
					}
				}*/
				//alert("星期"+weekday[new Date(i).getDay()])
				
			}
			var qxId;
			var mask=mui.createMask();//遮罩层
				/*
				 num==0：群测群防人员上报
				 num==1：片区人员人员上报
				 num==2：驻守人员上报
				 * */
			function loadtime(num){
				$.ajaxSettings.async = false;
				plus.nativeUI.showWaiting("加载中...");
				if(num=="0"){
					$("#monitor").html("");
					ajaxData(ipconfig +'station/meteor/findTabhumaninfoLv.do?areaId=' + qxId+"&startTime="+startTime+"&endTime="+endTime).done(function(json) {
						var data = json.data;
						for(var i = 0; i < data.length; i++) {
							var monitorContent = "<tr>" +
								"<td width='32%'>" + data[i].monitorTownship + "</td>" +
								"<td width='20%' class='ysb'>" + data[i].monitorEcho +"</td>" +
								"<td width='20%' class='ssb'>" + data[i].journalThen + "</td>" +
								"<td width='28%' class='sbl'>" + data[i].monitorRate + "%</td></tr>";
								$("#monitor").append(monitorContent);
						}
						$("#monitor tr").stop().hide();
						plus.nativeUI.closeWaiting();
						areaxz($("#area_xz"),"monitor");
					});
				}else if(num=="1"){
					$("#weekly").html("");
					ajaxData(ipconfig + 'station/meteor/findAreaAdminRate.do?areaId=' + qxId+"&startTime="+startTime1+"&endTime="+endTime1).done(function(json) {
						var data = json.data;
						for(var i = 0; i < data.length; i++) {
							var weeklyContent = "<tr class='numone'>" +
								"<td width='30%'>" + data[i].weeklyTownship + "</td>" +
								"<td width='20%' class='sbr'>" + data[i].weeklyReportPerson + "</td>" +
								"<td width='15%' class='ysb'>" + data[i].weeklyEcho + "</td>" +
								"<td width='15%' class='ssb'>" + data[i].weeklyThen + "</td>" +
								"<td width='20%' class='sbl'>" + data[i].weeklyRate + "%</td></tr>";
							$("#weekly").append(weeklyContent);
						}
						$("#weekly tr").stop().hide();
						plus.nativeUI.closeWaiting();
						areaxz($("#area_pq"),"weekly");
					});
				}else if(num=="2"){
					$("#journal").html("");
					ajaxData(ipconfig + "station/meteor/findTabworklogLv/" + qxId+".do?startTime="+startTime2+"&endTime="+endTime2).done(function(json) {
						var data = json.data;
						for(var i = 0; i < data.length; i++) {
							var journalContent = "<tr>" +
								"<td width='30%'>" + data[i].manage_area_name + "</td>" +
								"<td width='20%' class='sbr'>" + data[i].journalTownship + "</td>" +
								"<td width='15%' class='ysb'>" + data[i].journalecho + "</td>" +
								"<td width='15%' class='ssb'>" + data[i].journalThen + "</td>" +
								"<td width='20%' class='sbl'>" + data[i].journalRate + "%</td></tr>";
								$("#journal").append(journalContent);
						}
						$("#journal tr").stop().hide();
						plus.nativeUI.closeWaiting();
						areaxz($("#area_zs"),"journal");
					});
				}
				
			}
			/*时间戳转化*/
			function timestampToTime(timestamp) {
		        var date = new Date(timestamp * 1000);
		        Y = date.getFullYear() + '-';
		        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
		        D = date.getDate() + ' ';
		        return Y+M+D;
		    }
		mui.init();
			function areaxz(is,ids){
				$("#"+ids+" tr").stop().hide().filter(":contains('" + $(is).val() + "')").show();	
			}
		mui.plusReady(function() {
			//获取参数
			var info = JSON.parse(plus.storage.getItem("personal-information"));
			qxId = info[0].areaId;
			var qxName = info[0].area_name;
			//乡镇
			ajaxData(ipconfig + 'station/meteor/findAreaAdminRate.do?areaId=' + qxId).done(function(json) {
				var data = json.data;
				for(var i = 0; i < data.length; i++) {
					var sy=data[i].weeklyTownship.replace(/,/g, "");
					var week = "<option value="+ sy + ">" + sy + "</option>" ;
					$(".pqry").append(week);
				}
			});
			//片区专管人员周报情况统计
			ajaxData(ipconfig + 'station/meteor/findAreaAdminRate.do?areaId=' + qxId).done(function(json) {
				var data = json.data;
				for(var i = 0; i < data.length; i++) {
					var weeklyContent = "<tr class='numone'>" +
						"<td width='30%'>" + data[i].weeklyTownship.replace(/,/g, "") + "</td>" +
						"<td width='20%' class='sbr'>" + data[i].weeklyReportPerson + "</td>" +
						"<td width='15%' class='ysb'>" + data[i].weeklyEcho + "</td>" +
						"<td width='15%' class='ssb'>" + data[i].weeklyThen + "</td>" +
						"<td width='20%' class='sbl'>" + data[i].weeklyRate + "%</td></tr>";
					$("#weekly").append(weeklyContent);
				}
			});
			//群测群防人员上报率findTabhumaninfoLv
			ajaxData(ipconfig +'station/meteor/findTabhumaninfoLv.do?areaId=' + qxId).done(function(json) {
				var data = json.data;
				for(var i = 0; i < data.length; i++) {
					var monitorContent = "<tr>" +
						"<td width='32%'>" + data[i].monitorTownship.replace(/,/g, "") + "</td>" +
						"<td width='20%' class='ysb'>" + data[i].monitorEcho + "</td>" +
						"<td width='20%' class='ssb'>" + data[i].journalThen + "</td>" +
						"<td width='28%' class='sbl'>" + data[i].monitorRate + "%</td></tr>";
						$("#monitor").append(monitorContent);
				}
			});

			//驻守人员日志上报统计
			ajaxData(ipconfig + "station/meteor/findTabworklogLv/" + qxId+".do").done(function(json) {
				var data = json.data;
				for(var i = 0; i < data.length; i++) {
					var journalContent = "<tr>" +
						"<td width='30%'>" + data[i].manage_area_name + "</td>" +
						"<td width='20%' class='sbr'>" + data[i].journalTownship + "</td>" +
						"<td width='15%' class='ysb'>" + data[i].journalecho + "</td>" +
						"<td width='15%' class='ssb'>" + data[i].journalThen + "</td>" +
						"<td width='20%' class='sbl'>" + data[i].journalRate + "%</td></tr>";
						$("#journal").append(journalContent);
				}
			});
			//获取参数
			//			console.log(info[0].area_name);
		});
	</script>

</html>